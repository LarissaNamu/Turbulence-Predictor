<!DOCTYPE html>
<html lang="en">
<!-- IMPORT STUFF AND SET TITLE HERE-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbulence Tracker</title>
    
    <!-- Leaflet CSS-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
    </style>
</head>

<body>
    <div id="map"></div>
</body>

</html>

<!-- import leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    var set_longitude = 37.44; // set longitude for default map view
    var set_latitude = -92.48; // set latitude for default map view

    var starting_longitude = 32.9; // set longitude for starting airport
    var starting_latitude = -97.0405; // set latitude for starting airport
    var ending_longitude = 41.98; // set longitude for ending airport
    var ending_latitude = -87.91; // set latitude for ending airport

    var map = L.map('map').setView([set_longitude, set_latitude], 6);
    
    var greenIcon = L.icon({
        iconUrl: 'starting.png',
        iconSize: [30, 30], // size of the icon
    });

    var redIcon = L.icon({
        iconUrl: 'ending.png',
        iconSize: [30, 30], // size of the icon
    });

    // flight path
    // var DFWMarker = L.marker([32.9, -97.0405]).addTo(map);
    // var ORDMarker = L.marker([41.98, -87.91]).addTo(map);
    L.marker([starting_longitude, starting_latitude], {icon: greenIcon}).addTo(map).bindPopup("Starting Airport");
    L.marker([ending_longitude, ending_latitude], {icon: redIcon}).addTo(map).bindPopup("Ending Airport");

    // flight path
    var FlightPath = L.polygon([
    [starting_longitude, starting_latitude],
    [ending_longitude, ending_latitude]
    ]).addTo(map);

    // airport highlight variable
    var Airports = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-97.04792631,32.92348455],[-97.05405751,32.92229946],[-97.05538012,32.92219633],[-97.05682559,32.92228126],[-97.05759169,32.92214779],[-97.05875529,32.92015182],[-97.06032362,32.91879891],[-97.06229669,32.91785853],[-97.06349643,32.91751877],[-97.06453717,32.91739743],[-97.06728356,32.91739137],[-97.06734138,32.91702734],[-97.06749316,32.91096614],[-97.06760879,32.90748335],[-97.06802798,32.90738019],[-97.06807134,32.9057601],[-97.0712297,32.90576617],[-97.07122247,32.90315089],[-97.07163443,32.90316303],[-97.07945669,32.91075892],[-97.0793474,32.91091544],[-97.07937312,32.91109894],
    [-97.08062674,32.91232947],[-97.08209895,32.91126085],[-97.08378973,32.91293933],[-97.08618126,32.9111799],[-97.08623912,32.90910199],[-97.08594339,32.9088807],[-97.08510122,32.90801174],[-97.08231753,32.90588518],[-97.08105747,32.90527527],[-97.08070389,32.90518891],[-97.07961741,32.90408782],[-97.07851165,32.90230661],[-97.07549009,32.8994998],[-97.07240425,32.89721649],[-97.07238496,32.89705455],[-97.07215995,32.89688721],[-97.0719928,32.89689261],[-97.06559611,32.89004772],[-97.0662647,32.8897562],[-97.06701688,32.88974541],[-97.06706188,32.88629036],[-97.06251669,32.88631195],[-97.06253598,32.88707855],[-97.06139807,32.8876454],[-97.06030517,32.88858474],[-97.06018302,32.88858474],[-97.06020231,32.88739167],
    [-97.0593987,32.88737547],[-97.05941156,32.87930427],[-97.05916726,32.87827844],[-97.05905797,32.87824065],[-97.05902583,32.87807328],[-97.05912869,32.87801929],[-97.05871081,32.87695025],[-97.05817722,32.87631315],[-97.05691717,32.87541147],[-97.05611999,32.87472036],[-97.05540639,32.8726362],[-97.05446778,32.87104334],[-97.05421062,32.86911568],[-97.05254555,32.86963945],[-97.05175481,32.86976904],[-97.05097692,32.86976904],[-97.05092549,32.87003362],[-97.039405,32.86994183],[-97.03926357,32.87587041],[-97.03529697,32.87588121],[-97.0352584,32.87413723],[-97.03503982,32.87306275],[-97.03395977,32.87307355],[-97.03379262,32.87169669],[-97.03365761,32.87140511],[-97.03343903,32.87121073],[-97.03311116,32.87106494],
    [-97.03275115,32.87098935],[-97.02496582,32.87097855],[-97.02461223,32.87100555],[-97.02425222,32.87116213],[-97.02398863,32.87139431],[-97.0238472,32.87167509],[-97.02254857,32.87764135],[-97.02207927,32.87769534],[-97.02209855,32.87817046],[-97.0123835,32.87801222],[-97.01235558,32.8768554],[-97.01283954,32.87686322],[-97.01289539,32.87474494],[-97.01216944,32.86962492],[-97.00938663,32.87002359],[-97.00746939,32.8706724],[-97.00794865,32.89764509],[-97.00301006,32.89343569],[-97.00312421,32.89314813],[-97.00260533,32.89279086],[-97.0023459,32.89294771],[-96.99703778,32.88840766],[-96.99531511,32.88880852],[-96.99531751,32.88901756],[-96.99336884,32.88903308],[-96.99392862,32.88953862],[-96.99407649,32.89192435],
    [-96.99423492,32.89261611],[-96.99462571,32.89321918],[-96.99891383,32.89693507],[-97.00249431,32.8999325],[-97.00483905,32.90110306],[-97.00973976,32.90494276],[-97.00969752,32.90519105],[-97.01007775,32.90522652],[-97.01667892,32.91002368],[-97.01527419,32.91132711],[-97.01605577,32.91192119],[-97.01588678,32.91214286],[-97.01614027,32.91230246],[-97.01596262,32.91249148],[-97.02214894,32.91773397],[-97.02224276,32.91829512],[-97.02328652,32.91836404],[-97.02339206,32.91983088],[-97.02328652,32.92003762],[-97.02325133,32.92101222],[-97.02369698,32.92166195],[-97.02490493,32.92272513],[-97.02567895,32.92329609],[-97.02695726,32.92379814],[-97.02872813,32.92375877],[-97.02902132,32.92352251],[-97.03185941,32.9235422],
    [-97.03242233,32.92329609],[-97.03265688,32.9229417],[-97.033384,32.91982104],[-97.03334881,32.91947648],[-97.03431107,32.91765409],[-97.03425163,32.9137021],[-97.0350838,32.91369212],[-97.03538101,32.9130534],[-97.03687891,32.91303344],[-97.03696213,32.91259432],[-97.0388048,32.9126043],[-97.03881668,32.91118711],[-97.03937543,32.91048849],[-97.04137264,32.91042861],[-97.04171739,32.91063819],[-97.04600902,32.9107879],[-97.04631811,32.91097753],[-97.04636566,32.91711519],[-97.04787546,32.91939052],[-97.04792631,32.92348455]]]},"id":"39a48141-aeb6-45a0-baa3-3b844cf93c3f","properties":{"name":"DFW Airport"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-87.89608357,42.00514008],[-87.89607396,42.0049616],
    [-87.89670808,42.00497588],[-87.89670808,42.0046546],[-87.90390429,42.00464746],[-87.90431743,42.00481881],[-87.90903484,42.00484737],[-87.90909249,42.00516864],[-87.9129452,42.00514722],[-87.91301245,42.0062324],[-87.91369461,42.00623954],[-87.91377147,42.00513294],[-87.91472264,42.00514008],[-87.91472264,42.00533998],[-87.91822947,42.00839556],[-87.92492608,42.00824564],[-87.93356346,42.0018416],[-87.93574443,41.99924268],[-87.93541776,41.99909988],[-87.93632089,41.99852153],[-87.93653226,41.99825734],[-87.93632089,41.99799316],[-87.93679167,41.99768613],[-87.93830074,41.99397349],[-87.93770955,41.99255579],[-87.93753866,41.99165297],[-87.93766718,41.98944492],[-87.93765985,41.98615885],[-87.93750588,41.98397895],[-87.93882558,41.9839408],
    [-87.93879626,41.97787481],[-87.93864962,41.9765231],[-87.93876693,41.97623968],[-87.93876693,41.97162837],[-87.93865695,41.97119774],[-87.93841501,41.96925718],[-87.93823905,41.96926808],[-87.93823905,41.96914815],[-87.93733726,41.96911545],[-87.93732992,41.96888105],[-87.93711731,41.96885924],[-87.93710997,41.96475984],[-87.93700733,41.96446546],[-87.93676539,41.96419834],[-87.93636948,41.96402934],[-87.9359809,41.96395302],[-87.93400868,41.96395847],[-87.93363477,41.96387124],[-87.93335616,41.96364773],[-87.93316554,41.96333699],[-87.93318753,41.96154338],[-87.93304823,41.96109088],[-87.93291626,41.96096548],[-87.93309222,41.96030581],[-87.93263033,41.96048027],[-87.93185317,41.95926449],[-87.93191916,41.9591391],
    [-87.93169187,41.95852847],[-87.93215377,41.95828313],[-87.93273297,41.95803233],[-87.93307756,41.95773792],[-87.93322419,41.95749257],[-87.93355412,41.95742715],[-87.93359078,41.95715454],[-87.93329018,41.95717635],[-87.93323886,41.95685467],[-87.93298958,41.95656025],[-87.93231507,41.95622767],[-87.93157457,41.9560641],[-87.92807003,41.95549161],[-87.92603183,41.95543709],[-87.92121493,41.95540438],[-87.91908874,41.95518083],[-87.91383927,41.9536269],[-87.90850182,41.95210019],[-87.90460138,41.95148405],[-87.90459405,41.94965193],[-87.89688114,41.94759074],[-87.89700577,41.95072613],[-87.89753365,41.9515822],[-87.89632393,41.95213836],[-87.89498957,41.95335428],[-87.89018733,41.95780334],[-87.89026064,41.95793965],[-87.88933686,41.95823406],
    [-87.88838374,41.95845214],[-87.88770189,41.95850666],[-87.88676344,41.95849031],[-87.88590564,41.95838126],[-87.88471791,41.95797781],[-87.88432933,41.95801052],[-87.87928514,41.96214307],[-87.87824405,41.9633806],[-87.8775842,41.96450362],[-87.87704458,41.96566907],[-87.87675041,41.9673273],[-87.87688724,41.96874134],[-87.87955526,41.9781149],[-87.88020516,41.97869467],[-87.88064983,41.9789642],[-87.881245,41.97913203],[-87.88186754,41.97922865],[-87.88258586,41.97909643],[-87.88265427,41.97979315],[-87.88149128,41.98045935],[-87.88158706,41.98200531],[-87.87948001,41.98484288],[-87.87945948,41.98574294],[-87.87940475,41.98627687],[-87.87932266,41.98702436],[-87.879179,41.98716165],[-87.87967156,41.98878373],[-87.87828966,41.98879898],[-87.8804446,41.99482928],
    [-87.88082086,41.99495639],[-87.88469975,41.99480386],[-87.88476816,41.99802215],[-87.89108248,41.99941517],[-87.88939957,42.00052855],[-87.88937905,42.00300943],[-87.89169133,42.00403124],[-87.89500926,42.00405666],[-87.8950161,42.00459044],[-87.89513924,42.00483445],[-87.89562495,42.00502254],[-87.89608357,42.00514008]]]},"id":"b824e66c-c496-49dd-a1e2-f68d60da6d70","properties":{"name":"ORD Airport"}}]}

    L.geoJSON(Airports).addTo(map) // adding airport highlights to map

    //subdivision
    distance = Math.sqrt((ending_longitude - starting_longitude)**2 + (ending_latitude - starting_latitude)**2 );
    slope = (ending_latitude - starting_latitude) / (ending_longitude - starting_longitude);
    multiplier = distance / 25;
    
    turbulence_range = [25, 25, 26.25, 27.5, 28.75, 57.5, 56.25, 25, 23.75, 22.5, 22.10714286, 24.21428571, 26.32142857, 28.42857143, 29.28571429, 31.39285714, 32.25, 33.10714286, 53.96428571, 34.82142857, 35.67857143, 36.53571429, 37.39285714, 38.25];

    for (i = 0; i < 25; i++) {
        var lat = starting_latitude + (i * multiplier);
        var long = starting_longitude + (i * multiplier);
        if (long >= ending_longitude || lat >= ending_latitude) {
            break;
        }
        if (turbulence_range[i] <= 55) {
            continue;
        }
        else if (turbulence_range[i] <= 145 && turbulence_range[i] > 55) {
            L.circle([long, lat], {color: 'yellow',fillColor: '#FFFF00',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
        else if (turbulence_range[i] >= 146) {
            L.circle([long, lat], {color: 'red',fillColor: '#f03',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
    }

    // watermark
    L.Control.Watermark = L.Control.extend({
            onAdd:function(map){
                var img = L.DomUtil.create('img');
                img.src = 'turbulence_predictor_logo.png'
                img.style.width = '400px';
                return img;
            },
            onRemove:function(map){},
        });

        L.control.watermark = function(opts){
            return new L.Control.Watermark(opts);
        }

        L.control.watermark().addTo(map);

    L.tileLayer('https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=EqaU7EvvYtANunDniLZM', {attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>', }).addTo(map);
</script>