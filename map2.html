<!DOCTYPE html>
<html lang="en">
<!-- IMPORT STUFF AND SET TITLE HERE-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbulence Tracker</title>
    
    <!-- Leaflet CSS-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
    </style>
</head>

<body>
    <div id="map"></div>
</body>

</html>

<!-- import leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    var set_longitude = 37.44; // set longitude for default map view
    var set_latitude = -92.48; // set latitude for default map view

    var starting_longitude = 32.8984; // set longitude for starting airport
    var starting_latitude = -97.0338; // set latitude for starting airport
    var ending_longitude = 42.9438; // set longitude for ending airport
    var ending_latitude = -87.9009; // set latitude for ending airport

    var map = L.map('map').setView([set_longitude, set_latitude], 6);
    
    var greenIcon = L.icon({
        iconUrl: 'starting.png',
        iconSize: [30, 30], // size of the icon
    });

    var redIcon = L.icon({
        iconUrl: 'ending.png',
        iconSize: [30, 30], // size of the icon
    });

    // airport markers
    L.marker([starting_longitude, starting_latitude], {icon: greenIcon}).addTo(map).bindPopup("DFW Airport");
    L.marker([ending_longitude, ending_latitude], {icon: redIcon}).addTo(map).bindPopup("MKE Airport");

    // flight path
    var FlightPath = L.polygon([
    [starting_longitude, starting_latitude],
    [ending_longitude, ending_latitude]
    ]).addTo(map);

    // airport highlight variable CHANGE
    var Airports = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-97.04792631,32.92348455],[-97.05405751,32.92229946],[-97.05538012,32.92219633],[-97.05682559,32.92228126],[-97.05759169,32.92214779],[-97.05875529,32.92015182],[-97.06032362,32.91879891],[-97.06229669,32.91785853],[-97.06349643,32.91751877],[-97.06453717,32.91739743],[-97.06728356,32.91739137],[-97.06734138,32.91702734],[-97.06749316,32.91096614],[-97.06760879,32.90748335],[-97.06802798,32.90738019],[-97.06807134,32.9057601],[-97.0712297,32.90576617],[-97.07122247,32.90315089],[-97.07163443,32.90316303],[-97.07945669,32.91075892],[-97.0793474,32.91091544],[-97.07937312,32.91109894],[-97.08062674,32.91232947],[-97.08209895,32.91126085],[-97.08378973,32.91293933],[-97.08618126,32.9111799],[-97.08623912,32.90910199],[-97.08594339,32.9088807],[-97.08510122,32.90801174],[-97.08231753,32.90588518],[-97.08105747,32.90527527],[-97.08070389,32.90518891],[-97.07961741,32.90408782],[-97.07851165,32.90230661],[-97.07549009,32.8994998],[-97.07240425,32.89721649],[-97.07238496,32.89705455],[-97.07215995,32.89688721],[-97.0719928,32.89689261],[-97.06559611,32.89004772],[-97.0662647,32.8897562],[-97.06701688,32.88974541],[-97.06706188,32.88629036],[-97.06251669,32.88631195],[-97.06253598,32.88707855],[-97.06139807,32.8876454],[-97.06030517,32.88858474],[-97.06018302,32.88858474],[-97.06020231,32.88739167],[-97.0593987,32.88737547],[-97.05941156,32.87930427],[-97.05916726,32.87827844],[-97.05905797,32.87824065],[-97.05902583,32.87807328],[-97.05912869,32.87801929],[-97.05871081,32.87695025],[-97.05817722,32.87631315],[-97.05691717,32.87541147],[-97.05611999,32.87472036],[-97.05540639,32.8726362],[-97.05446778,32.87104334],[-97.05421062,32.86911568],[-97.05254555,32.86963945],[-97.05175481,32.86976904],[-97.05097692,32.86976904],[-97.05092549,32.87003362],[-97.039405,32.86994183],[-97.03926357,32.87587041],[-97.03529697,32.87588121],[-97.0352584,32.87413723],[-97.03503982,32.87306275],[-97.03395977,32.87307355],[-97.03379262,32.87169669],[-97.03365761,32.87140511],[-97.03343903,32.87121073],[-97.03311116,32.87106494],[-97.03275115,32.87098935],[-97.02496582,32.87097855],[-97.02461223,32.87100555],[-97.02425222,32.87116213],[-97.02398863,32.87139431],[-97.0238472,32.87167509],[-97.02254857,32.87764135],[-97.02207927,32.87769534],[-97.02209855,32.87817046],[-97.0123835,32.87801222],[-97.01235558,32.8768554],[-97.01283954,32.87686322],[-97.01289539,32.87474494],[-97.01216944,32.86962492],[-97.00938663,32.87002359],[-97.00746939,32.8706724],[-97.00794865,32.89764509],[-97.00301006,32.89343569],[-97.00312421,32.89314813],[-97.00260533,32.89279086],[-97.0023459,32.89294771],[-96.99703778,32.88840766],[-96.99531511,32.88880852],[-96.99531751,32.88901756],[-96.99336884,32.88903308],[-96.99392862,32.88953862],[-96.99407649,32.89192435],[-96.99423492,32.89261611],[-96.99462571,32.89321918],[-96.99891383,32.89693507],[-97.00249431,32.8999325],[-97.00483905,32.90110306],[-97.00973976,32.90494276],[-97.00969752,32.90519105],[-97.01007775,32.90522652],[-97.01667892,32.91002368],[-97.01527419,32.91132711],[-97.01605577,32.91192119],[-97.01588678,32.91214286],[-97.01614027,32.91230246],[-97.01596262,32.91249148],[-97.02214894,32.91773397],[-97.02224276,32.91829512],[-97.02328652,32.91836404],[-97.02339206,32.91983088],[-97.02328652,32.92003762],[-97.02325133,32.92101222],[-97.02369698,32.92166195],[-97.02490493,32.92272513],[-97.02567895,32.92329609],[-97.02695726,32.92379814],[-97.02872813,32.92375877],[-97.02902132,32.92352251],[-97.03185941,32.9235422],[-97.03242233,32.92329609],[-97.03265688,32.9229417],[-97.033384,32.91982104],[-97.03334881,32.91947648],[-97.03431107,32.91765409],[-97.03425163,32.9137021],[-97.0350838,32.91369212],[-97.03538101,32.9130534],[-97.03687891,32.91303344],[-97.03696213,32.91259432],[-97.0388048,32.9126043],[-97.03881668,32.91118711],[-97.03937543,32.91048849],[-97.04137264,32.91042861],[-97.04171739,32.91063819],[-97.04600902,32.9107879],[-97.04631811,32.91097753],[-97.04636566,32.91711519],[-97.04787546,32.91939052],[-97.04792631,32.92348455]]]},"id":"39a48141-aeb6-45a0-baa3-3b844cf93c3f","properties":{"name":"DFW Airport"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-87.88795462,42.96638754],[-87.89378925,42.96640577],[-87.89401347,42.96611044],[-87.89414301,42.96273775],[-87.8970977,42.96274504],[-87.89710766,42.96148342],[-87.89613107,42.96148342],[-87.89614104,42.95904034],[-87.90301703,42.95902575],[-87.90301205,42.96051349],[-87.90367972,42.96053537],[-87.90369965,42.96140685],[-87.90390892,42.96139956],[-87.9039139,42.96127923],[-87.90428261,42.96127923],[-87.90431749,42.96091095],[-87.90508481,42.96092553],[-87.90510474,42.96131569],[-87.90716754,42.96133757],[-87.9071775,42.96180795],[-87.90897622,42.96180795],[-87.90899117,42.95987537],[-87.90841817,42.95986443],[-87.90841319,42.95906221],[-87.90916058,42.95903669],[-87.90930009,42.95897105],[-87.90944957,42.9586611],[-87.90942466,42.95816518],[-87.90947947,42.95795732],[-87.90953428,42.94572562],[-87.90997463,42.94570432],[-87.910572,42.94571115],[-87.9120001,42.94596395],[-87.91259281,42.94594687],[-87.91761916,42.94464869],[-87.91951395,42.94390393],[-87.91970063,42.94353838],[-87.91993398,42.94334707],[-87.92023267,42.94323091],[-87.92070404,42.94303276],[-87.92196412,42.94242464],[-87.92222081,42.94223674],[-87.92246816,42.94199759],[-87.9225755,42.94177894],[-87.92264084,42.94153637],[-87.92276218,42.94022101],[-87.92468498,42.94024835],[-87.92424161,42.93543426],[-87.92413427,42.93502082],[-87.92291152,42.93502766],[-87.92290219,42.93527367],[-87.91977064,42.93523608],[-87.91976597,42.93557093],[-87.92060136,42.93558118],[-87.92059203,42.93582719],[-87.91972397,42.93580669],[-87.9197473,42.9361142],[-87.91863189,42.93610053],[-87.91862256,42.93663354],[-87.91761916,42.93667113],[-87.91760049,42.93690347],[-87.91543034,42.93691372],[-87.91540234,42.93741597],[-87.91312485,42.93748089],[-87.91310151,42.93806514],[-87.90983929,42.93806514],[-87.90490161,42.93787381],[-87.90489228,42.93741939],[-87.90261479,42.93739889],[-87.90263346,42.9362372],[-87.90961994,42.9362577],[-87.90966661,42.93600144],[-87.90844852,42.93600486],[-87.9085652,42.93149114],[-87.90659106,42.93146039],[-87.90662373,42.93027808],[-87.89893253,42.93020633],[-87.8989512,42.92987487],[-87.89905854,42.92983728],[-87.89976793,42.92984069],[-87.90007128,42.92986461],[-87.9004213,42.92977235],[-87.90119136,42.92978602],[-87.90124736,42.92985436],[-87.90146671,42.92984753],[-87.9017654,42.92967326],[-87.90174673,42.92947848],[-87.90165806,42.92929395],[-87.90141071,42.92913335],[-87.90070132,42.92877113],[-87.90023929,42.92866178],[-87.90010395,42.9285661],[-87.8999126,42.92840891],[-87.89980993,42.9281697],[-87.8998846,42.92756144],[-87.89986593,42.92725388],[-87.89977259,42.92696683],[-87.89954858,42.92667295],[-87.89912855,42.92638931],[-87.89868518,42.92624237],[-87.89822782,42.92619794],[-87.89779379,42.92621845],[-87.89728509,42.92635172],[-87.89686039,42.92662169],[-87.89654304,42.92706252],[-87.89607634,42.92917094],[-87.896053,42.92939647],[-87.89579632,42.92962883],[-87.89549763,42.92966984],[-87.89553497,42.92984753],[-87.89659437,42.92985778],[-87.89655704,42.93020291],[-87.88780643,42.93017215],[-87.88659768,42.93733739],[-87.8902286,42.93733397],[-87.88963589,42.94082915],[-87.88761509,42.94065833],[-87.88754975,42.94077791],[-87.8873724,42.94076082],[-87.88724173,42.94076424],[-87.88713439,42.94146804],[-87.88680303,42.94146804],[-87.88664902,42.94231873],[-87.88680303,42.94235973],[-87.88658835,42.94357938],[-87.8868497,42.94362038],[-87.88683103,42.94376045],[-87.88659768,42.94374336],[-87.88654634,42.94385952],[-87.88663502,42.9438766],[-87.88662102,42.94406792],[-87.8868637,42.94407475],[-87.88687303,42.94399959],[-87.88838981,42.94405767],[-87.88868383,42.94373995],[-87.8892532,42.94373995],[-87.88917386,42.94418065],[-87.88722772,42.94476143],[-87.88582763,42.94462477],[-87.88579029,42.94440272],[-87.8853936,42.94438222],[-87.88272875,42.9588964],[-87.88981324,42.95903985],[-87.88973857,42.9610652],[-87.88942121,42.9620659],[-87.88815646,42.96397504],[-87.88795578,42.96467516],[-87.88795462,42.96638754]]]},"id":"99974211-c2a1-4a74-8e5e-d434fcdb6adf","properties":{"name":"MKE"}}]}

    L.geoJSON(Airports).addTo(map) // adding airport highlights to map

    //subdivision
    distance = Math.sqrt((ending_longitude - starting_longitude)**2 + (ending_latitude - starting_latitude)**2 );
    console.log(distance)
    slope = (ending_latitude - starting_latitude) / (ending_longitude - starting_longitude);
    console.log(slope)
    multiplier = distance / 25;
    
    turbulence_range = [25, 26.25, 27.5, 47.5, 47.5, 46.25, 46.25, 56.25, 56.25, 66.25, 66.25, 66.25, 56.25, 180, 61.25, 61.25, 61.25, 61.25, 61.25, 61.25, 51.25, 51.25, 51.25, 43.75];

    for (i = 0; i < 25; i++) {
        lat = starting_latitude + (i * slope * multiplier);
        long = starting_longitude + (i * multiplier);
        
        if (long >= ending_longitude || lat >= ending_latitude) {
            break;
        }
        if (turbulence_range[i] <= 55) {
            continue;
        }
        else if (turbulence_range[i] <= 145 && turbulence_range[i] > 55) {
            L.circle([long, lat], {color: 'yellow',fillColor: '#FFFF00',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
        else if (turbulence_range[i] >= 146) {
            L.circle([long, lat], {color: 'red',fillColor: '#f03',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
    }

    // watermark
    L.Control.Watermark = L.Control.extend({
            onAdd:function(map){
                var img = L.DomUtil.create('img');
                img.src = 'turbulence_predictor_logo.png'
                img.style.width = '400px';
                return img;
            },
            onRemove:function(map){},
        });

        L.control.watermark = function(opts){
            return new L.Control.Watermark(opts);
        }

        L.control.watermark().addTo(map)

    L.tileLayer('https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=EqaU7EvvYtANunDniLZM', {attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>', }).addTo(map);
</script>