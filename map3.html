<!DOCTYPE html>
<html lang="en">
<!-- IMPORT STUFF AND SET TITLE HERE-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turbulence Tracker</title>
    
    <!-- Leaflet CSS-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
    </style>
</head>

<body>
    <div id="map"></div>
</body>

</html>

<!-- import leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    var set_longitude = 27.44; // set longitude for default map view
    var set_latitude = -88.48; // set latitude for default map view

    var starting_longitude = 25.7951; // set longitude for starting airport
    var starting_latitude = -80.2795; // set latitude for starting airport
    var ending_longitude = 32.8984; // set longitude for ending airport
    var ending_latitude = -97.0338; // set latitude for ending airport

    var map = L.map('map').setView([set_longitude, set_latitude], 6);
    
    var greenIcon = L.icon({
        iconUrl: 'starting.png',
        iconSize: [30, 30], // size of the icon
    });

    var redIcon = L.icon({
        iconUrl: 'ending.png',
        iconSize: [30, 30], // size of the icon
    });

    // flight markers
    L.marker([starting_longitude, starting_latitude], {icon: greenIcon}).addTo(map).bindPopup("MIA Airport");
    L.marker([ending_longitude, ending_latitude], {icon: redIcon}).addTo(map).bindPopup("DFW Airport");

    // flight path
    var FlightPath = L.polygon([
    [starting_longitude, starting_latitude],
    [ending_longitude, ending_latitude]
    ]).addTo(map);

    // airport highlight variable CHANGE THIS TO CHANGE AIRPORT HIGHLIGHTS
    var Airports = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-97.04792631,32.92348455],[-97.05405751,32.92229946],[-97.05538012,32.92219633],[-97.05682559,32.92228126],[-97.05759169,32.92214779],[-97.05875529,32.92015182],[-97.06032362,32.91879891],[-97.06229669,32.91785853],[-97.06349643,32.91751877],[-97.06453717,32.91739743],[-97.06728356,32.91739137],[-97.06734138,32.91702734],[-97.06749316,32.91096614],[-97.06760879,32.90748335],[-97.06802798,32.90738019],[-97.06807134,32.9057601],[-97.0712297,32.90576617],[-97.07122247,32.90315089],[-97.07163443,32.90316303],[-97.07945669,32.91075892],[-97.0793474,32.91091544],[-97.07937312,32.91109894],[-97.08062674,32.91232947],[-97.08209895,32.91126085],[-97.08378973,32.91293933],[-97.08618126,32.9111799],[-97.08623912,32.90910199],[-97.08594339,32.9088807],[-97.08510122,32.90801174],[-97.08231753,32.90588518],[-97.08105747,32.90527527],[-97.08070389,32.90518891],[-97.07961741,32.90408782],[-97.07851165,32.90230661],[-97.07549009,32.8994998],[-97.07240425,32.89721649],[-97.07238496,32.89705455],[-97.07215995,32.89688721],[-97.0719928,32.89689261],[-97.06559611,32.89004772],[-97.0662647,32.8897562],[-97.06701688,32.88974541],[-97.06706188,32.88629036],[-97.06251669,32.88631195],[-97.06253598,32.88707855],[-97.06139807,32.8876454],[-97.06030517,32.88858474],[-97.06018302,32.88858474],[-97.06020231,32.88739167],[-97.0593987,32.88737547],[-97.05941156,32.87930427],[-97.05916726,32.87827844],[-97.05905797,32.87824065],[-97.05902583,32.87807328],[-97.05912869,32.87801929],[-97.05871081,32.87695025],[-97.05817722,32.87631315],[-97.05691717,32.87541147],[-97.05611999,32.87472036],[-97.05540639,32.8726362],[-97.05446778,32.87104334],[-97.05421062,32.86911568],[-97.05254555,32.86963945],[-97.05175481,32.86976904],[-97.05097692,32.86976904],[-97.05092549,32.87003362],[-97.039405,32.86994183],[-97.03926357,32.87587041],[-97.03529697,32.87588121],[-97.0352584,32.87413723],[-97.03503982,32.87306275],[-97.03395977,32.87307355],[-97.03379262,32.87169669],[-97.03365761,32.87140511],[-97.03343903,32.87121073],[-97.03311116,32.87106494],[-97.03275115,32.87098935],[-97.02496582,32.87097855],[-97.02461223,32.87100555],[-97.02425222,32.87116213],[-97.02398863,32.87139431],[-97.0238472,32.87167509],[-97.02254857,32.87764135],[-97.02207927,32.87769534],[-97.02209855,32.87817046],[-97.0123835,32.87801222],[-97.01235558,32.8768554],[-97.01283954,32.87686322],[-97.01289539,32.87474494],[-97.01216944,32.86962492],[-97.00938663,32.87002359],[-97.00746939,32.8706724],[-97.00794865,32.89764509],[-97.00301006,32.89343569],[-97.00312421,32.89314813],[-97.00260533,32.89279086],[-97.0023459,32.89294771],[-96.99703778,32.88840766],[-96.99531511,32.88880852],[-96.99531751,32.88901756],[-96.99336884,32.88903308],[-96.99392862,32.88953862],[-96.99407649,32.89192435],[-96.99423492,32.89261611],[-96.99462571,32.89321918],[-96.99891383,32.89693507],[-97.00249431,32.8999325],[-97.00483905,32.90110306],[-97.00973976,32.90494276],[-97.00969752,32.90519105],[-97.01007775,32.90522652],[-97.01667892,32.91002368],[-97.01527419,32.91132711],[-97.01605577,32.91192119],[-97.01588678,32.91214286],[-97.01614027,32.91230246],[-97.01596262,32.91249148],[-97.02214894,32.91773397],[-97.02224276,32.91829512],[-97.02328652,32.91836404],[-97.02339206,32.91983088],[-97.02328652,32.92003762],[-97.02325133,32.92101222],[-97.02369698,32.92166195],[-97.02490493,32.92272513],[-97.02567895,32.92329609],[-97.02695726,32.92379814],[-97.02872813,32.92375877],[-97.02902132,32.92352251],[-97.03185941,32.9235422],[-97.03242233,32.92329609],[-97.03265688,32.9229417],[-97.033384,32.91982104],[-97.03334881,32.91947648],[-97.03431107,32.91765409],[-97.03425163,32.9137021],[-97.0350838,32.91369212],[-97.03538101,32.9130534],[-97.03687891,32.91303344],[-97.03696213,32.91259432],[-97.0388048,32.9126043],[-97.03881668,32.91118711],[-97.03937543,32.91048849],[-97.04137264,32.91042861],[-97.04171739,32.91063819],[-97.04600902,32.9107879],[-97.04631811,32.91097753],[-97.04636566,32.91711519],[-97.04787546,32.91939052],[-97.04792631,32.92348455]]]},"id":"39a48141-aeb6-45a0-baa3-3b844cf93c3f","properties":{"name":"DFW Airport"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-80.26474383,25.80810038],[-80.26793741,25.80802192],[-80.26934198,25.80809115],[-80.28378232,25.80759736],[-80.28627875,25.80756044],[-80.28910838,25.80742661],[-80.28908788,25.80715894],[-80.29894545,25.80713587],[-80.30085238,25.80684513],[-80.30343595,25.80679437],[-80.30419975,25.80670207],[-80.30459959,25.80670668],[-80.30483026,25.80659593],[-80.30494816,25.80634672],[-80.3048764,25.80331468],[-80.30500968,25.80266858],[-80.30528136,25.80199016],[-80.30585549,25.80127482],[-80.30629634,25.8006887],[-80.30643987,25.80002873],[-80.30639886,25.79678885],[-80.30776242,25.79675192],[-80.30768552,25.78902106],[-80.30911059,25.78899337],[-80.31007431,25.78879951],[-80.31589248,25.78875797],[-80.3166614,25.78868874],[-80.31728679,25.78850412],[-80.31784554,25.7881441],[-80.31829664,25.78772408],[-80.31865034,25.78725328],[-80.31892716,25.78657478],[-80.3190348,25.78597935],[-80.31898867,25.78560086],[-80.31886564,25.78529622],[-80.3184453,25.78477464],[-80.31774302,25.78443769],[-80.31237594,25.78441461],[-80.31243746,25.78383764],[-80.31156089,25.78380995],[-80.31130458,25.78372225],[-80.3111713,25.78356069],[-80.3111508,25.78295602],[-80.30944379,25.78355608],[-80.30696786,25.78456693],[-80.30698324,25.78485311],[-80.30643987,25.78496851],[-80.29312825,25.78532605],[-80.28495439,25.78585359],[-80.27990116,25.78600013],[-80.27889621,25.78595617],[-80.2749049,25.78518683],[-80.2742173,25.78521248],[-80.27352563,25.78542496],[-80.27300485,25.78578765],[-80.27222774,25.78654965],[-80.26782549,25.79132306],[-80.26581966,25.7944112],[-80.26521751,25.79628676],[-80.26502628,25.7977044],[-80.26503442,25.80119165],[-80.26506697,25.80172279],[-80.26517682,25.8019096],[-80.2653477,25.80533445],[-80.26511579,25.80618424],[-80.26472927,25.8069278],[-80.26474383,25.80810038]]]},"id":"49612f23-522e-4184-b456-b88c60b52163","properties":{"name":"MIA"}}]}

    L.geoJSON(Airports).addTo(map) // adding airport highlights to map

    //subdivision
    distance = Math.sqrt((ending_longitude - starting_longitude)**2 + (ending_latitude - starting_latitude)**2 );
    slope = (ending_latitude - starting_latitude) / (ending_longitude - starting_longitude);
    multiplier = distance / 25;
    
    turbulence_range = [9, 26.46428571, 24.82142857, 35.25, 43.17857143, 31.10714286, 16.25, 16.25, 31.25, 35, 26.25, 56, 2.5, 27.5, 25, 0, 12.5, 7.5, 20.21428571, 46.46428571, 55.21428571, 35.21428571, 22.71428571, 30.21428571];

    for (i = 0; i < 25; i++) {
        var lat = starting_latitude + (i * slope * multiplier);
        var long = starting_longitude + (i * multiplier);
        if (long >= ending_longitude || lat >= ending_latitude) {
            break;
        }
        if (turbulence_range[i] <= 55) {
            continue;
        }
        else if (turbulence_range[i] <= 145 && turbulence_range[i] > 55) {
            L.circle([long, lat], {color: 'yellow',fillColor: '#FFFF00',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
        else if (turbulence_range[i] >= 146) {
            L.circle([long, lat], {color: 'red',fillColor: '#f03',fillOpacity: 0.5,radius: 37000}).addTo(map);
        }
    }

    // watermark
    L.Control.Watermark = L.Control.extend({
            onAdd:function(map){
                var img = L.DomUtil.create('img');
                img.src = 'turbulence_predictor_logo.png'
                img.style.width = '400px';
                return img;
            },
            onRemove:function(map){},
        });

        L.control.watermark = function(opts){
            return new L.Control.Watermark(opts);
        }

        L.control.watermark().addTo(map)

    L.tileLayer('https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=EqaU7EvvYtANunDniLZM', {attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>', }).addTo(map);
</script>